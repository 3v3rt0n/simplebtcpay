<?php
/*

{
  "hash160": "f54cbd3bb0c7e9b44e85727dd3695cec32ca1df5",
  "address": "1PN2UvzrgwS2j4UY1mLurQYyoCPbrUYD1f",
  "n_tx": 2,
  "total_received": 131921,
  "total_sent": 131921,
  "final_balance": 0,
  "txs": [
    {
      "result": 0,
      "block_height": 323096,
      "time": 1412023189,
      "inputs": [
        {
          "sequence": 4294967295,
          "prev_out": {
            "n": 0,
            "value": 131921,
            "addr": "1PN2UvzrgwS2j4UY1mLurQYyoCPbrUYD1f",
            "tx_index": 65603137,
            "type": 0,
            "script": "76a914f54cbd3bb0c7e9b44e85727dd3695cec32ca1df588ac"
          },
          "script": "4830450221008dcf46cda4bc25478e9057ff8c4f6edce9f6138a2bc3822ff715accb0331ddf80220060978c6bda88f4bbd40d8099bdad69edfd8f35aa22f6aa646a5ade7e251677a012102304328f576e351e8ad481dc622aace49bf1b2695289718722d3ce45a03c667f7"
        }
      ],
      "vout_sz": 1,
      "relayed_by": "68.168.105.168",
      "hash": "be2fc6a9206cbdb7dd3fcb8a2e71339847ccd9b259da5a4104ba050075db8dd0",
      "vin_sz": 1,
      "tx_index": 65607229,
      "ver": 1,
      "out": [
        {
          "n": 0,
          "value": 121921,
          "addr": "1Bpx1hsWjAQDBgc6cJ3dkGnCHqQDnvuEkD",
          "tx_index": 65607229,
          "spent": true,
          "type": 0,
          "script": "76a91476c2bad8de905d0eb4ce798fd900831318494b5288ac"
        }
      ],
      "size": 192
    },
    {
      "result": -131921,
      "block_height": 323092,
      "time": 1412019749,
      "inputs": [
        {
          "sequence": 4294967295,
          "prev_out": {
            "n": 0,
            "value": 131921,
            "addr": "12SoGbFTt4qeRinVVByWv8cpnFaEAb4WJU",
            "tx_index": 65603133,
            "type": 0,
            "script": "76a9140fd925e8852e0ca24adf55b378a39991046b627988ac"
          },
          "script": "493046022100d5f8487e08de41c426797786a1615dce3708cd341d304ec5a3aeac7cad6fead1022100e35473c3498ee5a17746369d98812dc7686d8f994eff44bf9c7cae534cccb2270141042d95a3dc3b5e89e6dd97b8a109ba8d6a6e2cec882cca20acb3635ae377cbba21f26ab844b087d7621ed564f63dfefa1d5fee10e0ff0478ec6b8375d8465b385f"
        },
        {
          "sequence": 4294967295,
          "prev_out": {
            "n": 2,
            "value": 237488,
            "addr": "1w6SDM95HUDNhTgXeTSWGuXkA2QB1Goa5",
            "tx_index": 65575093,
            "type": 0,
            "script": "76a9140a3affa43c6a435ff8b429b3041e31e538a348b788ac"
          },
          "script": "473044022044934ee1cf9469b46f8bc9f81c223c267f6be46f25f47d6c84fc03bf3459ab9402203dcc7639bf2c6ae5224c236cf4b64b37e8fb3d3c5bed57b2e650d1e36b875c95014104b9bac2e12513fa8c87f0b06323bd6a8e699c43f916251d6805f618aba1624e748433ccbb3bd89155e37c700f673a76d1bcd70d87405a17e72e87ca422adec324"
        }
      ],
      "vout_sz": 2,
      "relayed_by": "54.164.168.173",
      "hash": "d5d82017cac21e03b1a854d6b1fc46d7fb22a40a0b5f9df5ec68e7943714abda",
      "vin_sz": 2,
      "tx_index": 65603137,
      "ver": 1,
      "out": [
        {
          "n": 0,
          "value": 131921,
          "addr": "1PN2UvzrgwS2j4UY1mLurQYyoCPbrUYD1f",
          "tx_index": 65603137,
          "spent": false,
          "type": 0,
          "script": "76a914f54cbd3bb0c7e9b44e85727dd3695cec32ca1df588ac"
        },
        {
          "n": 1,
          "value": 217488,
          "addr": "1AphD3fsVsJGRNNvNYJWB3RBUAJCRNJpAF",
          "tx_index": 65603137,
          "spent": false,
          "type": 0,
          "script": "76a9146bbe3ef66dc43192a858c9c0e26d25535833972188ac"
        }
      ],
      "size": 438
    }
  ]
}


{
  "address": "1PN2UvzrgwS2j4UY1mLurQYyoCPbrUYD1f",
  "balance": 0,
  "unconfirmed_balance": 0,
  "final_balance": 0,
  "n_tx": 2,
  "txrefs": [
    {
      "tx_hash": "be2fc6a9206cbdb7dd3fcb8a2e71339847ccd9b259da5a4104ba050075db8dd0",
      "block_height": 323096,
      "tx_input_n": 0,
      "tx_output_n": -1,
      "value": 131921,
      "spent": false,
      "confirmations": 151,
      "confirmed": "2014-09-29T20:43:00Z",
      "double_spend": false
    },
    {
      "tx_hash": "d5d82017cac21e03b1a854d6b1fc46d7fb22a40a0b5f9df5ec68e7943714abda",
      "block_height": 323092,
      "tx_input_n": -1,
      "tx_output_n": 0,
      "value": 131921,
      "spent": true,
      "spent_by": "be2fc6a9206cbdb7dd3fcb8a2e71339847ccd9b259da5a4104ba050075db8dd0",
      "confirmations": 155,
      "confirmed": "2014-09-29T19:50:57Z",
      "double_spend": false
    }
  ],
  "tx_url": "https://api.blockcypher.com/v1/btc/main/txs/"
}

 */


class AddressHistory   {

   public $address          = null;
   public $n_tx             = 0;
   public $total_sent       = 0;
   public $total_received   = 0;
   public $balance          = 0;
   public $final_balance    = 0;
   public $txns = array();

   public function __construct($txn=null)
   {
      if(! is_array($txn))    return null;

      //- TODO standardize the interface and throw exception if not enough info
      if(array_key_exists('address', $txn))       $this->address = $txn['address'];
      if(array_key_exists('n_tx', $txn))          $this->n_tx = $txn['n_tx'];
      if(array_key_exists('total_sent', $txn))    $this->total_sent = $txn['total_sent'];
      if(array_key_exists('total_received', $txn))$this->total_received = $txn['total_received'];
      if(array_key_exists('balance', $txn))       $this->balance = $txn['balance'];
      if(array_key_exists('final_balance', $txn)) $this->final_balance = $txn['final_balance'];

      if(is_array($txn['txns']))  {
         foreach($txn['txns'] as $key => $this_txn)  {
            $new_txn = array(
                           'hash'         => $this_txn['hash'],
                           'block_height' => $this_txn['block_height'],
                           'value'        => $this_txn['value'],
                           'spent'        => $this_txn['spent'],
                           'spent_by'     => $this_txn['spent_by'],
                           'confirmations'=> $this_txn['confirmations']
                           );
            $this->txns[$key] = new TransRef($new_txn);
         }
      }   else    {
         $this->txns = null;
      }

      return $this;
   }
}
